<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esportes - Hermes News</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="styles/esportes.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- TinyMCE CSS -->
    <link rel="stylesheet" href="https://cdn.tiny.cloud/1/ob3ervoew0qvf52y1oyonvpkrhld2gx0cdjxogrwp0zdoe9k/tinymce/6/skins/ui/oxide/skin.min.css">
    
    <!-- Script do TinyMCE -->
    <script src="https://cdn.tiny.cloud/1/ob3ervoew0qvf52y1oyonvpkrhld2gx0cdjxogrwp0zdoe9k/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
</head>
<body>
    <header class="main-header">
        <div class="header-container">
            <div class="logo">
                <a href="index.html">
                    <img src="hermeslogo.png" alt="Hermes News Logo">
                    <h1>HERMES <span>NEWS</span></h1>
                </a>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="../index.html">Política</a></li>
                    <li><a href="../index.html">Economia</a></li>
                    <li><a href="../index.html">Tecnologia</a></li>
                    <li><a href="../index.html">Cultura</a></li>
                    <li><a href="indexesportes.html" class="active">Esportes</a></li>
                </ul>
            </nav>
            <div class="search-container">
                <i class="fas fa-search"></i>
                <button class="subscribe-btn">Assine</button>
            </div>
            <div class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </header>

    <main class="sports-main">
        <!-- Destaque Principal -->
        <section class="breaking-news sports-breaking">
            <div class="breaking-tag">
                <i class="fas fa-running"></i>
                <span>DESTAQUE ESPORTIVO</span>
            </div>
            <div class="breaking-content" id="featured-article">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Carregando destaque...</p>
                </div>
            </div>
        </section>

        <div class="sports-layout">
            <!-- Conteúdo Principal -->
            <section class="sports-content">
                <!-- Matérias em Destaque -->
                <div class="section-header">
                    <h2><i class="fas fa-star"></i> Destaques</h2>
                </div>
                <div class="featured-articles" id="featured-articles">
                    <!-- Carregado via JavaScript -->
                </div>

                <!-- Últimas Notícias -->
                <div class="section-header">
                    <h2><i class="far fa-newspaper"></i> Últimas Notícias</h2>
                    <a href="#" class="see-all">Ver todas</a>
                </div>
                <div class="articles-grid" id="articles-grid">
                    <!-- Carregado via JavaScript -->
                </div>
            </section>

            <!-- Sidebar -->
            <aside class="sports-sidebar">
                <!-- Tabela de Classificação -->
                <div class="standings-widget">
                    <div class="widget-header">
                        <h3><i class="fas fa-trophy"></i> Brasileirão Série A</h3>
                        <button id="refresh-standings" title="Atualizar">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div id="standings-container">
                        <div class="loading-spinner small">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Carregando tabela...</p>
                        </div>
                    </div>
                </div>

                <!-- Acesso do Editor -->
                <div class="editor-widget">
                    <h3><i class="fas fa-user-edit"></i> Área do Editor</h3>
                    <div id="editor-access">
                        <a href="login.html" class="editor-btn">
                            <i class="fas fa-sign-in-alt"></i> Acesso Restrito
                        </a>
                    </div>
                </div>

                <!-- Patrocinadores -->
                <div class="sponsors-widget">
                    <h3><i class="fas fa-star"></i> Patrocinadores</h3>
                <div class="sponsored-card">
                    <div class="sponsored-content">
                        <h3>Formatação de TCC sem stress!</h3>
                        <p class="sponsored-description">Formatação automática nas normas ABNT, rápida e acessível. Ideal para estudantes universitários.</p>
                        <a href="https://tucc.netlify.app/" target="_blank" class="sponsored-link">Conheça a TUCC <i class="fas fa-arrow-right"></i></a>
                    </div>
                    <div class="sponsored-badge">Patrocinado</div>
                </div>
                </div>
            </aside>
        </div>
    </main>

    <footer class="main-footer">
        <div class="footer-container">
            <div class="footer-logo">
                <img src="../hermeslogobranco.png" alt="Hermes News Logo">
                <h2>HERMES <span>NEWS</span></h2>
                <p>Notícias rápidas e confiáveis, como as asas de Hermes.</p>
            </div>
            <div class="footer-links">
                <div class="links-column">
                    <h3>Categorias</h3>
                    <ul>
                        <li><a href="../index.html">Política</a></li>
                        <li><a href="../index.html">Economia</a></li>
                        <li><a href="../index.html">Tecnologia</a></li>
                        <li><a href="../index.html">Cultura</a></li>
                        <li><a href="index.html">Esportes</a></li>
                    </ul>
                </div>
                <div class="links-column">
                    <h3>Sobre</h3>
                    <ul>
                        <li><a href="#">Quem somos</a></li>
                        <li><a href="#">Nossa equipe</a></li>
                        <li><a href="contato.html">Contato</a></li>
                        <li><a href="#">Trabalhe conosco</a></li>
                    </ul>
                </div>
                <div class="links-column">
                    <h3>Redes Sociais</h3>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Hermes News. Todos os direitos reservados.</p>
            <div class="legal-links">
                <a href="#">Termos de uso</a>
                <a href="#">Política de privacidade</a>
                <a href="#">Cookies</a>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script type="module">
        // Importações Firebase
        import { app } from 'firebase-init.js';
        import { getFirestore, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";
        
        // Inicializa Firestore
        const db = getFirestore(app);

        // Elementos DOM
        const featuredArticleContainer = document.getElementById('featured-article');
        const featuredArticlesContainer = document.getElementById('featured-articles');
        const articlesGrid = document.getElementById('articles-grid');
        const standingsContainer = document.getElementById('standings-container');

        // Carrega o artigo em destaque
        async function loadFeaturedArticle() {
            try {
                const q = query(
                    collection(db, "sportsArticles"),
                    where("published", "==", true),
                    orderBy("createdAt", "desc"),
                    limit(1)
                );
                
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    const doc = querySnapshot.docs[0];
                    const article = { id: doc.id, ...doc.data() };
                    
                    featuredArticleContainer.innerHTML = `
                        <h2>${article.title}</h2>
                        <p>${article.excerpt || article.content.substring(0, 150)}...</p>
                        <a href="article.html?id=${article.id}" class="read-more">
                            Ler mais <i class="fas fa-arrow-right"></i>
                        </a>
                    `;
                }
            } catch (error) {
                console.error("Erro ao carregar destaque:", error);
                featuredArticleContainer.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Erro ao carregar conteúdo</p>
                    </div>
                `;
            }
        }

        // Carrega artigos em destaque
        async function loadFeaturedArticles() {
            try {
                const q = query(
                    collection(db, "sportsArticles"),
                    where("published", "==", true),
                    orderBy("createdAt", "desc"),
                    limit(3)
                );
                
                const querySnapshot = await getDocs(q);
                featuredArticlesContainer.innerHTML = '';
                
                querySnapshot.forEach(doc => {
                    const article = { id: doc.id, ...doc.data() };
                    featuredArticlesContainer.innerHTML += `
                        <article class="featured-card">
                            <div class="card-image">
                                <img src="${article.image || '../images/sports-default.jpg'}" alt="${article.title}">
                                <span class="category-tag ${article.category || 'futebol'}">${article.category || 'Futebol'}</span>
                            </div>
                            <div class="card-content">
                                <h3>${article.title}</h3>
                                <p class="excerpt">${article.excerpt || article.content.substring(0, 100)}...</p>
                                <div class="card-footer">
                                    <span class="author">Por ${article.author || 'Redação Esportes'}</span>
                                    <span class="date">${new Date(article.createdAt).toLocaleDateString('pt-BR')}</span>
                                </div>
                                <a href="article.html?id=${article.id}" class="hidden-link"></a>
                            </div>
                        </article>
                    `;
                });
            } catch (error) {
                console.error("Erro ao carregar destaques:", error);
            }
        }

        // Carrega a tabela de classificação
        async function fetchBrasileiraoStandings() {
            try {
                const response = await fetch('https://api.api-futebol.com.br/v1/campeonatos/10/tabela', {
                    headers: {
                        'Authorization': 'Bearer live_3eb0324b1a17d7b79bbb6861216367'
                    }
                });
                
                if (!response.ok) throw new Error('Erro na API');
                
                const data = await response.json();
                renderStandings(data);
            } catch (error) {
                console.error("Falha na API, usando fallback:", error);
                renderStandings(getStaticStandings());
            }
        }

        // Renderiza a tabela de classificação
        function renderStandings(standings) {
            standingsContainer.innerHTML = `
                <div class="standings-header">
                    <span>Pos</span>
                    <span>Time</span>
                    <span>Pts</span>
                    <span>PJ</span>
                    <span>V</span>
                    <span>E</span>
                    <span>D</span>
                </div>
                <div class="standings-body">
                    ${standings.slice(0, 20).map((team, index) => `
                        <div class="standing-row ${index < 4 ? 'libertadores' : ''} ${index > 15 ? 'rebaixamento' : ''}">
                            <span class="position">${team.posicao}</span>
                            <span class="team">
                                <img src="${team.time.escudo}" alt="${team.time.nome_popular}" 
                                     onerror="this.src='../images/team-placeholder.png'">
                                ${team.time.nome_popular}
                            </span>
                            <span class="points">${team.pontos}</span>
                            <span class="played">${team.jogos}</span>
                            <span class="wins">${team.vitorias}</span>
                            <span class="draws">${team.empates}</span>
                            <span class="losses">${team.derrotas}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="standings-footer">
                    <div class="legend">
                        <span class="libertadores"></span> Libertadores
                        <span class="rebaixamento"></span> Zona de rebaixamento
                    </div>
                    <div class="last-update">
                        Atualizado em: ${new Date().toLocaleString('pt-BR')}
                    </div>
                </div>
            `;
        }

        // Fallback estático para a tabela
        function getStaticStandings() {
            return [...Array(20)].map((_, i) => ({
                posicao: i + 1,
                time: {
                    nome_popular: ["Flamengo", "Palmeiras", "Atlético-MG", "Corinthians", "Fluminense"][i % 5] || `Time ${i + 1}`,
                    escudo: `../images/team${(i % 5) + 1}.png`
                },
                pontos: 72 - (i * 3),
                jogos: 38,
                vitorias: 22 - i,
                empates: 5 + (i % 3),
                derrotas: 11 - (i % 2)
            }));
        }

        // Carrega todas as notícias
        async function loadAllArticles() {
            try {
                const q = query(
                    collection(db, "sportsArticles"),
                    where("published", "==", true),
                    orderBy("createdAt", "desc"),
                    limit(6)
                );
                
                const querySnapshot = await getDocs(q);
                articlesGrid.innerHTML = '';
                
                querySnapshot.forEach(doc => {
                    const article = { id: doc.id, ...doc.data() };
                    articlesGrid.innerHTML += `
                        <article class="article-card">
                            <div class="card-image">
                                <img src="${article.image || '../images/sports-default.jpg'}" alt="${article.title}">
                                <span class="category-tag ${article.category || 'futebol'}">${article.category || 'Futebol'}</span>
                            </div>
                            <div class="card-content">
                                <h3>${article.title}</h3>
                                <p class="excerpt">${article.excerpt || article.content.substring(0, 100)}...</p>
                                <a href="article.html?id=${article.id}" class="read-more">
                                    Ler mais <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </article>
                    `;
                });
            } catch (error) {
                console.error("Erro ao carregar notícias:", error);
            }
        }

        // Atualiza a tabela ao clicar no botão
        document.getElementById('refresh-standings')?.addEventListener('click', () => {
            standingsContainer.innerHTML = `
                <div class="loading-spinner small">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Atualizando...</p>
                </div>
            `;
            setTimeout(fetchBrasileiraoStandings, 1000);
        });

        // Menu mobile
        document.querySelector('.mobile-menu-btn').addEventListener('click', function() {
            const nav = document.querySelector('.main-nav');
            nav.style.display = nav.style.display === 'block' ? 'none' : 'block';
        });

        // Inicialização
        loadFeaturedArticle();
        loadFeaturedArticles();
        loadAllArticles();
        fetchBrasileiraoStandings();
    
    </script>
    <script src="https://cdn.tiny.cloud/1/66ta1oygks80puzfcekjbeuugi2c96zk9fyf19kovovb34qb/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
</body>
</html>